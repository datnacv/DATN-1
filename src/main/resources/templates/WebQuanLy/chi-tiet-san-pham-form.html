<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Chi Tiết Sản Phẩm</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/sidebar.js}" defer></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #eef2f7;
            color: #333;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px;
        }
        .page-title {
            color: #343a40;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .card-header {
            background-color: #ffffff;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 1.5rem;
            font-weight: 500;
        }
        .card-body {
            padding: 1.5rem;
        }
        .form-control, .form-select {
            border-radius: 0.375rem;
            border: 1px solid #ced4da;
        }
        .form-control:focus, .form-select:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        .btn {
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
        }
        .btn-warning {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #333;
        }
        .btn-warning:hover {
            background-color: #ffca2c;
            border-color: #ffc720;
        }
        .btn-success {
            background-color: #198754;
            border-color: #198754;
        }
        .btn-success:hover {
            background-color: #157347;
            border-color: #146c43;
        }
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        .btn i {
            margin-right: 0.4rem;
        }
        .table {
            margin-bottom: 0;
            border-color: #e9ecef;
            vertical-align: middle;
            width: 100%;
        }
        .table thead {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 500;
            border-bottom-width: 2px;
        }
        .table th {
            min-width: 50px;
        }
        .table td {
            text-align: center;
        }
        .table thead th:nth-child(2) { min-width: 80px; }
        .table thead th:nth-child(3) { min-width: 150px; }
        .table thead th:nth-child(4) { min-width: 100px; }
        .table thead th:nth-child(5) { min-width: 100px; }
        .table thead th:nth-child(6) { min-width: 100px; }
        .table thead th:nth-child(7) { min-width: 100px; }
        .table thead th:nth-child(8) { min-width: 100px; }
        .table thead th:nth-child(9) { min-width: 100px; }
        .table thead th:nth-child(10) { min-width: 100px; }
        .table thead th:nth-child(11) { min-width: 100px; }
        .table thead th:nth-child(12) { min-width: 130px; }
        .table thead th:nth-child(13) { min-width: 100px; }
        .table thead th:nth-child(14) { min-width: 100px; }
        .table thead th:nth-child(15) { min-width: 100px; }
        .table thead th:nth-child(16) { min-width: 130px; }
        .table-hover > tbody > tr:hover {
            background-color: rgba(0, 0, 0, 0.04);
        }
        .input-group .btn {
            z-index: 2;
        }
        .modal-header {
            background-color: #0d6efd;
            color: white;
            border-bottom: none;
        }
        .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
        .modal-content {
            border-radius: 0.75rem;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .modal-footer {
            border-top: 1px solid #e9ecef;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .table-responsive {
            border-radius: 0.75rem;
        }
        .product-image {
            max-width: 50px;
            max-height: 50px;
            object-fit: cover;
            border-radius: 0.25rem;
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-preview {
            position: relative;
            width: 100px;
            height: 100px;
        }
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.25rem;
            border: 1px solid #ced4da;
        }
        .image-preview .remove-image {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
        }
        .form-switch {
            align-items: center;
        }
        .form-check-input {
            cursor: pointer;
            width: 3em;
            height: 1.5em;
        }
        .form-check-label {
            font-size: 1rem;
            color: #333;
            margin-left: 1rem;
            transition: color 0.2s ease;
        }
        .form-check-input:checked + .form-check-label {
            color: #198754;
        }
        .form-check-input:not(:checked) + .form-check-label {
            color: #dc3545;
        }
        .status-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-block;
            white-space: nowrap;
        }

        .status-active {
            color: #198754;
            border: 1px solid #198754;
            background-color: rgba(25, 135, 84, 0.1);
        }

        .status-inactive {
            color: #dc3545;
            border: 1px solid #dc3545;
            background-color: rgba(220, 53, 69, 0.1);
        }

        .table td:nth-child(15), .table th:nth-child(15) {
            min-width: 150px !important;
        }
        .table td, .table th {
            vertical-align: middle;
            text-align: center;
        }
        .table td:nth-child(2) {
            padding: 0.5rem;
        }
        .table td:nth-child(2) div {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
        }
    </style>
</head>
<body>
<div class="d-flex">
    <div th:replace="~{fragments/sidebar :: sidebar}" class="fixed top-0 left-0 h-full bg-gray-800 text-white w-64"></div>

    <nav class="navbar custom-navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4 fixed top-0 right-0 w-[calc(100%-256px)] d-flex">
        <!-- Các phần tử khác bên trái (nếu có) -->

        <div class="ms-auto" th:replace="~{fragments/account_dropdown :: accountDropdown(user=${user})}"></div>
    </nav>
    <div class="content" id="content">
        <div class="text-center mb-2 mt-3">
            <h2 class="page-title">QUẢN LÝ CHI TIẾT SẢN PHẨM</h2>
        </div>
        <div class="card mb-4">
            <div class="card-body">
                <form th:action="@{/acvstore/chi-tiet-san-pham}" method="get">
                    <input type="hidden" name="productId" th:value="${selectedProductId}"/>
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4 col-lg-4">
                            <label for="productFilter" class="form-label">Sản phẩm</label>
                            <input type="text" class="form-control" id="productFilter" th:value="${sanPhamDaChon?.tenSanPham}" disabled/>
                            <input type="hidden" name="productId" th:value="${selectedProductId}"/>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="colorFilter" class="form-label">Màu sắc</label>
                            <select class="form-select" id="colorFilter" name="colorId" onchange="this.form.submit()">
                                <option value="">-- Tất cả màu sắc --</option>
                                <option th:each="c : ${mauSacs}" th:value="${c.id}" th:text="${c.tenMau}" th:selected="${c.id == selectedColorId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="sizeFilter" class="form-label">Kích cỡ</label>
                            <select class="form-select" id="sizeFilter" name="sizeId" onchange="this.form.submit()">
                                <option value="">-- Tất cả kích cỡ --</option>
                                <option th:each="s : ${kichCos}" th:value="${s.id}" th:text="${s.ten}" th:selected="${s.id == selectedSizeId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="originFilter" class="form-label">Xuất xứ</label>
                            <select class="form-select" id="originFilter" name="originId" onchange="this.form.submit()">
                                <option value="">-- Tất cả xuất xứ --</option>
                                <option th:each="o : ${xuatXus}" th:value="${o.id}" th:text="${o.tenXuatXu}" th:selected="${o.id == selectedOriginId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="materialFilter" class="form-label">Chất liệu</label>
                            <select class="form-select" id="materialFilter" name="materialId" onchange="this.form.submit()">
                                <option value="">-- Tất cả chất liệu --</option>
                                <option th:each="m : ${chatLieus}" th:value="${m.id}" th:text="${m.tenChatLieu}" th:selected="${m.id == selectedMaterialId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="styleFilter" class="form-label">Kiểu dáng</label>
                            <select class="form-select" id="styleFilter" name="styleId" onchange="this.form.submit()">
                                <option value="">-- Tất cả kiểu dáng --</option>
                                <option th:each="st : ${kieuDangs}" th:value="${st.id}" th:text="${st.tenKieuDang}" th:selected="${st.id == selectedStyleId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="sleeveFilter" class="form-label">Tay áo</label>
                            <select class="form-select" id="sleeveFilter" name="sleeveId" onchange="this.form.submit()">
                                <option value="">-- Tất cả tay áo --</option>
                                <option th:each="sa : ${tayAos}" th:value="${sa.id}" th:text="${sa.tenTayAo}" th:selected="${sa.id == selectedSleeveId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="collarFilter" class="form-label">Cổ áo</label>
                            <select class="form-select" id="collarFilter" name="collarId" onchange="this.form.submit()">
                                <option value="">-- Tất cả cổ áo --</option>
                                <option th:each="ca : ${coAos}" th:value="${ca.id}" th:text="${ca.tenCoAo}" th:selected="${ca.id == selectedCollarId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="brandFilter" class="form-label">Thương hiệu</label>
                            <select class="form-select" id="brandFilter" name="brandId" onchange="this.form.submit()">
                                <option value="">-- Tất cả thương hiệu --</option>
                                <option th:each="th : ${thuongHieus}" th:value="${th.id}" th:text="${th.tenThuongHieu}" th:selected="${th.id == selectedBrandId}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="genderFilter" class="form-label">Giới tính</label>
                            <select class="form-select" id="genderFilter" name="gender" onchange="this.form.submit()">
                                <option value="">-- Tất cả giới tính --</option>
                                <option value="Nam" th:selected="${selectedGender == 'Nam'}">Nam</option>
                                <option value="Nữ" th:selected="${selectedGender == 'Nữ'}">Nữ</option>
                                <option value="Unisex" th:selected="${selectedGender == 'Unisex'}">Unisex</option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4">
                            <label for="statusFilter" class="form-label">Trạng thái</label>
                            <select class="form-select" id="statusFilter" name="status" onchange="this.form.submit()">
                                <option value="">-- Tất cả trạng thái --</option>
                                <option value="true" th:selected="${selectedStatus != null and selectedStatus == true}">Hoạt động</option>
                                <option value="false" th:selected="${selectedStatus != null and selectedStatus == false}">Ngừng hoạt động</option>
                            </select>
                        </div>
                        <div class="col-md-4 col-lg-4 d-flex align-items-end">
                            <a th:href="@{/acvstore/chi-tiet-san-pham(productId=${selectedProductId})}" class="btn btn-warning w-100">
                                <i class="fas fa-filter"></i> Xóa bộ lọc
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-list me-2"></i> Danh sách chi tiết sản phẩm
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="chiTietSanPhamTable">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Ảnh</th>
                        <th>Sản phẩm</th>
                        <th>Màu sắc</th>
                        <th>Kích cỡ</th>
                        <th>Xuất xứ</th>
                        <th>Chất liệu</th>
                        <th>Kiểu dáng</th>
                        <th>Tay áo</th>
                        <th>Cổ áo</th>
                        <th>Thương hiệu</th>
                        <th>Giá</th>
                        <th>Số lượng tồn</th>
                        <th>Giới tính</th>
                        <th style="min-width: 150px;">Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${chiTietSanPhamList == null or chiTietSanPhamList.isEmpty()}">
                        <td colspan="16" class="text-center text-muted py-5">Chưa có chi tiết sản phẩm nào được thêm.</td>
                    </tr>
                    <tr th:each="pd, stats : ${chiTietSanPhamList}" th:data-id="${pd.id}">
                        <td th:text="${stats.count}"></td>
                        <td>
                            <div th:if="${pd.hinhAnhSanPhams != null and !pd.hinhAnhSanPhams.isEmpty()}">
                                <img th:src="${pd.hinhAnhSanPhams[0].urlHinhAnh}" class="product-image" alt="Ảnh sản phẩm" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                                <span style="display:none;" class="text-danger small">Ảnh lỗi</span>
                            </div>
                            <span th:unless="${pd.hinhAnhSanPhams != null and !pd.hinhAnhSanPhams.isEmpty()}" class="text-muted">Không có</span>
                        </td>
                        <td th:text="${pd.sanPham?.tenSanPham ?: 'N/A'}"></td>
                        <td th:text="${pd.mauSac?.tenMau ?: 'N/A'}"></td>
                        <td th:text="${pd.kichCo?.ten ?: 'N/A'}"></td>
                        <td th:text="${pd.xuatXu?.tenXuatXu ?: 'N/A'}"></td>
                        <td th:text="${pd.chatLieu?.tenChatLieu ?: 'N/A'}"></td>
                        <td th:text="${pd.kieuDang?.tenKieuDang ?: 'N/A'}"></td>
                        <td th:text="${pd.tayAo?.tenTayAo ?: 'N/A'}"></td>
                        <td th:text="${pd.coAo?.tenCoAo ?: 'N/A'}"></td>
                        <td th:text="${pd.thuongHieu?.tenThuongHieu ?: 'N/A'}"></td>
                        <td th:text="${#numbers.formatDecimal(pd.gia, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></td>
                        <td th:text="${pd.soLuongTonKho}"></td>
                        <td th:text="${pd.gioiTinh ?: 'N/A'}"></td>
                        <td style="min-width: 150px;">
                        <span th:class="${pd.trangThai} ? 'status-badge status-active' : 'status-badge status-inactive'"
                              th:text="${pd.trangThai} ? 'Hoạt động' : 'Ngừng hoạt động'"></span>
                        </td>
                        <td class="text-center action-buttons">
                            <button class="btn btn-warning btn-sm edit-btn" th:data-id="${pd.id}" data-bs-toggle="modal" data-bs-target="#editChiTietSanPhamModal" title="Sửa">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal fade" id="editChiTietSanPhamModal" tabindex="-1" aria-labelledby="editChiTietSanPhamModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editChiTietSanPhamModalLabel"><i class="fas fa-edit me-2"></i>Sửa Chi Tiết Sản Phẩm</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="editChiTietSanPhamForm" enctype="multipart/form-data">
                        <div class="modal-body">
                            <input type="hidden" id="editId" name="id"/>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editProduct" class="form-label">Sản phẩm</label>
                                    <input type="text" class="form-control" id="editProduct" th:value="${sanPhamDaChon?.tenSanPham}" disabled/>
                                    <input type="hidden" id="editProductHidden" name="productId" th:value="${selectedProductId}"/>
                                </div>
                                <div class="col-md-6">
                                    <label for="editColor" class="form-label">Màu sắc</label>
                                    <select class="form-select" id="editColor" name="colorId" required>
                                        <option value="">Chọn màu...</option>
                                        <option th:each="c : ${mauSacs}" th:value="${c.id}" th:text="${c.tenMau}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editSize" class="form-label">Kích cỡ</label>
                                    <select class="form-select" id="editSize" name="sizeId" required>
                                        <option value="">Chọn kích cỡ...</option>
                                        <option th:each="s : ${kichCos}" th:value="${s.id}" th:text="${s.ten}"></option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="editOrigin" class="form-label">Xuất xứ</label>
                                    <select class="form-select" id="editOrigin" name="originId" required>
                                        <option value="">Chọn xuất xứ...</option>
                                        <option th:each="o : ${xuatXus}" th:value="${o.id}" th:text="${o.tenXuatXu}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editMaterial" class="form-label">Chất liệu</label>
                                    <select class="form-select" id="editMaterial" name="materialId" required>
                                        <option value="">Chọn chất liệu...</option>
                                        <option th:each="m : ${chatLieus}" th:value="${m.id}" th:text="${m.tenChatLieu}"></option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="editStyle" class="form-label">Kiểu dáng</label>
                                    <select class="form-select" id="editStyle" name="styleId" required>
                                        <option value="">Chọn kiểu dáng...</option>
                                        <option th:each="st : ${kieuDangs}" th:value="${st.id}" th:text="${st.tenKieuDang}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editSleeve" class="form-label">Tay áo</label>
                                    <select class="form-select" id="editSleeve" name="sleeveId" required>
                                        <option value="">Chọn tay áo...</option>
                                        <option th:each="sa : ${tayAos}" th:value="${sa.id}" th:text="${sa.tenTayAo}"></option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="editCollar" class="form-label">Cổ áo</label>
                                    <select class="form-select" id="editCollar" name="collarId" required>
                                        <option value="">Chọn cổ áo...</option>
                                        <option th:each="ca : ${coAos}" th:value="${ca.id}" th:text="${ca.tenCoAo}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editBrand" class="form-label">Thương hiệu</label>
                                    <select class="form-select" id="editBrand" name="brandId" required>
                                        <option value="">Chọn thương hiệu...</option>
                                        <option th:each="th : ${thuongHieus}" th:value="${th.id}" th:text="${th.tenThuongHieu}"></option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="editGender" class="form-label">Giới tính</label>
                                    <select class="form-select" id="editGender" name="gender" required>
                                        <option value="">Chọn giới tính...</option>
                                        <option value="Nam">Nam</option>
                                        <option value="Nữ">Nữ</option>
                                        <option value="Unisex">Unisex</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editPrice" class="form-label">Giá bán</label>
                                    <div class="input-group">
                                        <span class="input-group-text">VNĐ</span>
                                        <input type="number" class="form-control" id="editPrice" name="price" step="1000" min="0" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="editStockQuantity" class="form-label">Số lượng tồn</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-boxes"></i></span>
                                        <input type="number" class="form-control" id="editStockQuantity" name="stockQuantity" min="0" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="editStatus" class="form-label">Trạng thái</label>
                                    <div class="form-check form-switch d-flex align-items-center">
                                        <input class="form-check-input" type="checkbox" id="editStatus" name="status" value="true">
                                        <label class="form-check-label ms-3" id="statusLabel" for="editStatus">Ngừng hoạt động</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-12">
                                    <label class="form-label">Ảnh hiện có (Nhấn nút '×' để xóa)</label>
                                    <div class="image-preview-container" id="existingImages"></div>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-12">
                                    <label for="editImages" class="form-label">Thêm ảnh mới (tối đa 3 ảnh)</label>
                                    <input type="file" class="form-control" id="editImages" name="imageFiles" multiple accept="image/*">
                                    <div class="image-preview-container" id="newImagesPreview"></div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i> Đóng
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Lưu thay đổi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        // $('#editColor').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn màu...", width: '100%' });
        // $('#editSize').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn kích cỡ...", width: '100%' });
        // $('#editOrigin').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn xuất xứ...", width: '100%' });
        // $('#editMaterial').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn chất liệu...", width: '100%' });
        // $('#editStyle').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn kiểu dáng...", width: '100%' });
        // $('#editSleeve').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn tay áo...", width: '100%' });
        // $('#editCollar').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn cổ áo...", width: '100%' });
        // $('#editBrand').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn thương hiệu...", width: '100%' });
        // $('#editGender').select2({ dropdownParent: $('#editChiTietSanPhamModal .modal-body'), placeholder: "Chọn giới tính...", width: '100%' });

        function updateStatusLabel() {
            const statusInput = $('#editStatus');
            const statusLabel = $('#statusLabel');
            const stockQuantity = parseInt($('#editStockQuantity').val()) || 0;
            if (stockQuantity === 0) {
                statusInput.prop('checked', false).prop('disabled', true);
                statusLabel.text('Ngừng hoạt động (Hết hàng)');
            } else {
                statusInput.prop('disabled', false);
                statusLabel.text(statusInput.is(':checked') ? 'Hoạt động' : 'Ngừng hoạt động');
            }
        }

        $('#editStatus').on('change', updateStatusLabel);
        $('#editStockQuantity').on('change', updateStatusLabel);

        $(document).on('click', '.edit-btn', function () {
            const productDetailId = $(this).data('id');
            $.ajax({
                url: '/acvstore/chi-tiet-san-pham/edit/' + productDetailId,
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    $('#editId').val(response.id);
                    $('#editProductHidden').val(response.productId);
                    $('#editColor').val(response.colorId).trigger('change');
                    $('#editSize').val(response.sizeId).trigger('change');
                    $('#editOrigin').val(response.originId).trigger('change');
                    $('#editMaterial').val(response.materialId).trigger('change');
                    $('#editStyle').val(response.styleId).trigger('change');
                    $('#editSleeve').val(response.sleeveId).trigger('change');
                    $('#editCollar').val(response.collarId).trigger('change');
                    $('#editBrand').val(response.brandId).trigger('change');
                    $('#editGender').val(response.gender).trigger('change');
                    $('#editPrice').val(response.price);
                    $('#editStockQuantity').val(response.stockQuantity);
                    $('#editStatus').prop('checked', response.status === true);
                    updateStatusLabel();

                    const existingImagesContainer = $('#existingImages');
                    existingImagesContainer.empty();
                    if (response.images && response.images.length > 0) {
                        response.images.forEach(image => {
                            const imageHtml = `
                                <div class="image-preview">
                                    <img src="${image.imageUrl}" alt="Ảnh sản phẩm">
                                    <button type="button" class="remove-image" data-image-id="${image.id}" onclick="deleteImage(this)">×</button>
                                </div>
                            `;
                            existingImagesContainer.append(imageHtml);
                        });
                    } else {
                        existingImagesContainer.append('<p class="text-muted">Không có ảnh nào.</p>');
                    }
                },
                error: function (xhr) {
                    alert("Lỗi khi tải dữ liệu chi tiết sản phẩm: " + (xhr.responseText || xhr.statusText));
                }
            });
        });

        window.deleteImage = function(button) {
            const imageId = $(button).data('image-id');
            if (confirm('Bạn có chắc muốn xóa ảnh này?')) {
                $.ajax({
                    url: '/acvstore/chi-tiet-san-pham/delete-image/' + imageId,
                    type: 'POST',
                    success: function (response) {
                        $(button).closest('.image-preview').remove();
                        alert(response.message);
                    },
                    error: function (xhr) {
                        alert("Lỗi khi xóa ảnh: " + (xhr.responseText || xhr.statusText));
                    }
                });
            }
        };

        $('#editImages').on('change', function () {
            const previewContainer = $('#newImagesPreview');
            previewContainer.empty();
            const files = this.files;
            if (files.length > 3) {
                alert('Bạn chỉ có thể tải lên tối đa 3 ảnh.');
                this.value = '';
                return;
            }
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewHtml = `
                        <div class="image-preview">
                            <img src="${e.target.result}" alt="Ảnh mới">
                        </div>
                    `;
                    previewContainer.append(previewHtml);
                };
                reader.readAsDataURL(file);
            });
        });

        $('#editChiTietSanPhamForm').on('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.set('status', $('#editStatus').is(':checked'));
            const id = $('#editId').val();
            $.ajax({
                url: '/acvstore/chi-tiet-san-pham/update/' + id,
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    $('#editChiTietSanPhamModal').modal('hide');
                    location.reload();
                },
                error: function (xhr) {
                    alert("Lỗi khi cập nhật chi tiết sản phẩm: " + (xhr.responseText || xhr.statusText));
                }
            });
        });
    });
</script>
</body>
</html>
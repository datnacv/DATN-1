<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký - ACV Store</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #8FC8F0 0%, #A8DDF8 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .register-container {
            background: #ffffff;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            max-width: 1100px;
            width: 100%;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow: hidden;
        }

        .register-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 16px;
            padding: 2px;
            background: linear-gradient(45deg, #1A3C6A, #4A90E2);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: -1;
        }

        .btn-custom {
            background: linear-gradient(90deg, #1A3C6A 0%, #2A5488 100%);
            color: white;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 12px;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-custom:hover {
            background: linear-gradient(90deg, #0F2B4F 0%, #1A3C6A 100%);
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(26, 60, 106, 0.3);
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e0e4eb;
            padding: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #1A3C6A;
            box-shadow: 0 0 8px rgba(26, 60, 106, 0.3);
            outline: none;
        }

        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.3);
        }

        .form-label {
            font-weight: 500;
            color: #1A3C6A;
            margin-bottom: 8px;
        }

        a {
            color: #1A3C6A;
            font-weight: 600;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: #0F2B4F;
        }

        h2 {
            color: #1A3C6A;
            font-weight: 700;
            font-size: 1.8rem;
        }

        h4 {
            color: #1A3C6A;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .form-section {
            padding: 0 20px;
        }

        .input-group-text {
            background: #f8f9fa;
            border: 2px solid #e0e4eb;
            border-left: none;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s ease;
        }

        .input-group > .form-control:focus + .input-group-text {
            border-color: #1A3C6A;
        }

        .alert-danger {
            border-radius: 10px;
            font-size: 0.95rem;
        }

        @media (max-width: 768px) {
            .form-section {
                margin-bottom: 30px;
            }

            .register-container {
                padding: 30px;
            }

            h2 {
                font-size: 1.5rem;
            }

            .btn-custom {
                font-size: 1rem;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
<div class="register-container text-center">
    <h2 class="fw-bold mb-4"><i class="fa-solid fa-user-plus me-2"></i> Đăng ký</h2>
    <p class="text-muted mb-4">Tạo tài khoản để mua sắm dễ dàng hơn!</p>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <form th:action="@{/customers/register/saveUser}" method="post" th:object="${nguoiDung}" id="registerForm">
        <div class="row">
            <!-- Basic Information Section -->
            <div class="col-md-6 form-section">
                <h4 class="mb-4">Thông tin cơ bản</h4>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Tên đăng nhập <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" th:field="*{tenDangNhap}" required>
                    <div class="invalid-feedback">Tên đăng nhập là bắt buộc.</div>
                </div>
                <div class="mb-4 text-start position-relative">
                    <label class="form-label fw-semibold">Mật khẩu <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <input type="password" class="form-control" th:field="*{matKhau}" id="passwordField" required autocomplete="new-password">
                        <span class="input-group-text" id="togglePassword" style="cursor: pointer;">
                            <i class="fa-solid fa-eye-slash" id="togglePasswordIcon"></i>
                        </span>
                    </div>
                    <div class="invalid-feedback">Mật khẩu là bắt buộc.</div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Họ và tên <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" th:field="*{hoTen}" required>
                    <div class="invalid-feedback">Họ và tên là bắt buộc.</div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" th:field="*{email}" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                    <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Số điện thoại <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" th:field="*{soDienThoai}" required pattern="[0-9]{10}">
                    <div class="invalid-feedback">Số điện thoại phải là 10 chữ số.</div>
                </div>
            </div>

            <!-- Address Information Section -->
            <div class="col-md-6 form-section">
                <h4 class="mb-4">Thông tin địa chỉ</h4>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Tỉnh/Thành phố <span class="text-danger">*</span></label>
                    <select class="form-select" th:field="*{tinhThanhPho}" id="province" required>
                        <option value="">Chọn Tỉnh/Thành phố</option>
                        <option th:each="province : ${provinces.data}" th:value="${province.ProvinceName}" th:text="${province.ProvinceName}" th:data-id="${province.ProvinceID}"></option>
                    </select>
                    <div class="invalid-feedback">Tỉnh/Thành phố là bắt buộc.</div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Quận/Huyện <span class="text-danger">*</span></label>
                    <select class="form-select" th:field="*{quanHuyen}" id="district" required>
                        <option value="">Chọn Quận/Huyện</option>
                    </select>
                    <div class="invalid-feedback">Quận/Huyện là bắt buộc.</div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Phường/Xã <span class="text-danger">*</span></label>
                    <select class="form-select" th:field="*{phuongXa}" id="ward" required>
                        <option value="">Chọn Phường/Xã</option>
                    </select>
                    <div class="invalid-feedback">Phường/Xã là bắt buộc.</div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label fw-semibold">Chi tiết địa chỉ <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" th:field="*{chiTietDiaChi}" required>
                    <div class="invalid-feedback">Chi tiết địa chỉ là bắt buộc.</div>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-custom w-100 mt-4">
            <i class="fa-solid fa-user-check me-2"></i> Đăng ký ngay
        </button>
    </form>

    <div class="mt-4">
        <p>Đã có tài khoản? <a href="/login">Đăng nhập ngay</a></p>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Client-side validation
        $('#registerForm').on('submit', function(e) {
            let isValid = true;
            $(this).find('[required]').each(function() {
                if (!$(this).val()) {
                    $(this).addClass('is-invalid');
                    isValid = false;
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
            if (!isValid) {
                e.preventDefault();
            }
        });

        // Password toggle
        document.getElementById("togglePassword").addEventListener("click", function () {
            const passwordField = document.getElementById("passwordField");
            const icon = document.getElementById("togglePasswordIcon");
            const isPassword = passwordField.type === "password";

            passwordField.type = isPassword ? "text" : "password";
            icon.classList.toggle("fa-eye");
            icon.classList.toggle("fa-eye-slash");
        });

        // Load districts when province changes
        $('#province').change(function() {
            let provinceName = $(this).val();
            let provinceId = $(this).find('option:selected').data('id');
            if (provinceId) {
                $.get('/customers/register/districts', { provinceId: provinceId }, function(response) {
                    let districts = response.data;
                    $('#district').empty().append('<option value="">Chọn Quận/Huyện</option>');
                    districts.forEach(function(district) {
                        $('#district').append('<option value="' + district.DistrictName + '" data-id="' + district.DistrictID + '">' + district.DistrictName + '</option>');
                    });
                    $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
                });
            } else {
                $('#district').empty().append('<option value="">Chọn Quận/Huyện</option>');
                $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
            }
        });

        // Load wards when district changes
        $('#district').change(function() {
            let districtId = $(this).find('option:selected').data('id');
            if (districtId) {
                $.get('/customers/register/wards', { districtId: districtId }, function(response) {
                    let wards = response.data;
                    $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
                    wards.forEach(function(ward) {
                        $('#ward').append('<option value="' + ward.WardName + '">' + ward.WardName + '</option>');
                    });
                });
            } else {
                $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
            }
        });
    });
</script>
</body>
</html>
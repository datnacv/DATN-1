<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký - ACV Store</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #9FD5F7;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .register-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 100%;
        }

        .btn-custom {
            background-color: #153054;
            color: white;
            border-radius: 30px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            background-color: #0f243f;
            transform: translateY(-2px);
        }

        .form-control, .form-select {
            border-radius: 8px;
        }

        .form-control:focus, .form-select:focus {
            border-color: #153054;
            box-shadow: 0 0 6px rgba(21, 48, 84, 0.4);
        }

        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #dc3545;
            box-shadow: 0 0 6px rgba(220, 53, 69, 0.4);
        }

        a {
            color: #153054;
            font-weight: 600;
        }

        a:hover {
            color: #0f243f;
        }

        h2 {
            color: #153054;
        }
    </style>
</head>
<body>
<div class="register-container text-center">
    <h2 class="fw-bold mb-3"><i class="fa-solid fa-user-plus"></i> Đăng ký</h2>
    <p class="text-muted">Tạo tài khoản để mua sắm dễ dàng hơn!</p>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <form th:action="@{/customers/register/saveUser}" method="post" th:object="${nguoiDung}">
    <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Tên đăng nhập <span class="text-danger">*</span></label>
            <input type="text" class="form-control" th:field="*{tenDangNhap}" required>
            <div class="invalid-feedback">Tên đăng nhập là bắt buộc.</div>
        </div>
        <div class="mb-3 text-start position-relative">
            <label class="form-label fw-semibold">Mật khẩu <span class="text-danger">*</span></label>
            <div class="input-group">
                <input type="password" class="form-control" th:field="*{matKhau}" id="passwordField" required autocomplete="new-password">
                <span class="input-group-text" id="togglePassword" style="cursor: pointer;">
            <i class="fa-solid fa-eye-slash" id="togglePasswordIcon"></i>
        </span>
            </div>
            <div class="invalid-feedback">Mật khẩu là bắt buộc.</div>
        </div>

        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Họ và tên <span class="text-danger">*</span></label>
            <input type="text" class="form-control" th:field="*{hoTen}" required>
            <div class="invalid-feedback">Họ và tên là bắt buộc.</div>
        </div>
        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Email <span class="text-danger">*</span></label>
            <input type="email" class="form-control" th:field="*{email}" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
            <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
        </div>
        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Số điện thoại <span class="text-danger">*</span></label>
            <input type="text" class="form-control" th:field="*{soDienThoai}" required pattern="[0-9]{10}">
            <div class="invalid-feedback">Số điện thoại phải là 10 chữ số.</div>
        </div>
        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Tỉnh/Thành phố <span class="text-danger">*</span></label>
            <select class="form-select" th:field="*{tinhThanhPho}" id="province" required>
                <option value="">Chọn Tỉnh/Thành phố</option>
                <option th:each="province : ${provinces.data}" th:value="${province.ProvinceID}" th:text="${province.ProvinceName}"></option>
            </select>
            <div class="invalid-feedback">Tỉnh/Thành phố là bắt buộc.</div>
        </div>
        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Quận/Huyện <span class="text-danger">*</span></label>
            <select class="form-select" th:field="*{quanHuyen}" id="district" required>
                <option value="">Chọn Quận/Huyện</option>
            </select>
            <div class="invalid-feedback">Quận/Huyện là bắt buộc.</div>
        </div>
        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Phường/Xã <span class="text-danger">*</span></label>
            <select class="form-select" th:field="*{phuongXa}" id="ward" required>
                <option value="">Chọn Phường/Xã</option>
            </select>
            <div class="invalid-feedback">Phường/Xã là bắt buộc.</div>
        </div>
        <div class="mb-3 text-start">
            <label class="form-label fw-semibold">Chi tiết địa chỉ <span class="text-danger">*</span></label>
            <input type="text" class="form-control" th:field="*{chiTietDiaChi}" required>
            <div class="invalid-feedback">Chi tiết địa chỉ là bắt buộc.</div>
        </div>

        <button type="submit" class="btn btn-custom w-100">
            <i class="fa-solid fa-user-check"></i> Đăng ký ngay
        </button>
    </form>

    <div class="mt-3">
        <p>Đã có tài khoản? <a href="/login">Đăng nhập ngay</a></p>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Client-side validation
        $('form').on('submit', function(e) {
            let isValid = true;
            $(this).find('[required]').each(function() {
                if (!$(this).val()) {
                    $(this).addClass('is-invalid');
                    isValid = false;
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
            if (!isValid) {
                e.preventDefault();
            }
        });

        // Load districts when province changes
        $('#province').change(function() {
            let provinceId = $(this).val();
            if (provinceId) {
                $.get('/customers/register/districts', { provinceId: provinceId }, function(response) {
                    let districts = response.data;
                    $('#district').empty().append('<option value="">Chọn Quận/Huyện</option>');
                    districts.forEach(function(district) {
                        $('#district').append('<option value="' + district.DistrictName + '" data-id="' + district.DistrictID + '">' + district.DistrictName + '</option>');
                    });
                    $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
                });
            }
        });


        // Load wards when district changes
        $('#district').change(function() {
            let districtId = $(this).find('option:selected').data('id');
            if (districtId) {
                $.get('/customers/register/wards', { districtId: districtId }, function(response) {
                    let wards = response.data;
                    $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
                    wards.forEach(function(ward) {
                        $('#ward').append('<option value="' + ward.WardName + '">' + ward.WardName + '</option>');
                    });
                });
            } else {
                $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');
            }
        });
    });
    document.getElementById("togglePassword").addEventListener("click", function () {
        const passwordField = document.getElementById("passwordField");
        const icon = document.getElementById("togglePasswordIcon");
        const isPassword = passwordField.type === "password";

        passwordField.type = isPassword ? "text" : "password";
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
    });
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ACV Store - Lịch Sử Giao Dịch Ví</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/image/ACV.png" type="image/png" sizes="32x32"/>

    <style>
        :root {
            --primary-color: #153054;
            --secondary-color: #9FD5F7;
            --accent-color: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding-top: 118px;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-lg);
        }

        .ticker {
            background: linear-gradient(90deg, var(--secondary-color) 0%, #b3e0ff 100%);
            color: var(--primary-color);
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1050;
            box-shadow: var(--shadow-sm);
        }

        .navbar {
            position: fixed;
            top: 40px;
            left: 0;
            width: 100%;
            z-index: 1040;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 200px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 0.5rem 0;
        }

        .dropdown:hover .dropdown-menu {
            display: block;
        }

        .user-info {
            display: none;
            color: white;
        }

        .user-info.active {
            display: inline;
        }

        #confirmAddToCart.loading::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid white;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #back-to-top {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            box-shadow: var(--shadow-lg);
        }

        #back-to-top.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(10px);
        }

        #back-to-top:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .search-suggestions.active {
            opacity: 1;
            visibility: visible;
        }
        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        .suggestion-item:hover {
            background-color: #f1f5f9;
        }
        .suggestion-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 4px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            background-color: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .history-item:hover {
            background-color: #e2e8f0;
        }
        .history-item .highlight {
            background-color: #9FD5F7;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .history-item .delete-btn {
            color: #ef4444;
            font-size: 14px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        .history-item .delete-btn:hover {
            color: #b91c1c;
        }.search-suggestions {
             position: absolute;
             top: 100%;
             left: 0;
             right: 0;
             background: white;
             border: 1px solid #ccc;
             border-radius: 8px;
             box-shadow: 0 4px 8px rgba(0,0,0,0.1);
             z-index: 1000;
             max-height: 300px;
             overflow-y: auto;
             opacity: 0;
             visibility: hidden;
             transition: opacity 0.3s ease, visibility 0.3s ease;
         }
        .search-suggestions.active {
            opacity: 1;
            visibility: visible;
        }
        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        .suggestion-item:hover {
            background-color: #f1f5f9;
        }
        .suggestion-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 4px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            background-color: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .history-item:hover {
            background-color: #e2e8f0;
        }
        .history-item .highlight {
            background-color: #9FD5F7;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .history-item .delete-btn {
            color: #ef4444;
            font-size: 14px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        .history-item .delete-btn:hover {
            color: #b91c1c;
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-item:hover {
            background: linear-gradient(90deg, var(--accent-color) 0%, #f1f5f9 100%);
            transform: translateX(4px);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            margin-right: 1rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .history-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            background: linear-gradient(90deg, var(--accent-color) 0%, #ffffff 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .history-item:hover {
            background: linear-gradient(90deg, #e2e8f0 0%, #f1f5f9 100%);
            transform: translateX(4px);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item .highlight {
            background: linear-gradient(90deg, var(--secondary-color) 0%, #b3e0ff 100%);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
        }

        .history-item .delete-btn {
            color: #ef4444;
            font-size: 14px;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .history-item .delete-btn:hover {
            color: #b91c1c;
            background-color: #fef2f2;
            transform: scale(1.1);
        }

        .main-container {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1200px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .main-container:hover {
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            transform: translateY(-2px);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 2px;
        }

        .page-title i {
            color: var(--secondary-color);
            margin-right: 1rem;
            font-size: 2.25rem;
        }

        .alert {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #b3e0ff 100%);
            border: none;
            border-left: 6px solid var(--primary-color);
            color: var(--primary-color);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            font-weight: 600;
            box-shadow: var(--shadow-md);
        }

        .table-container {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .table {
            margin-bottom: 0;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table th {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            color: white;
            font-weight: 700;
            padding: 1.5rem 1rem;
            text-align: left;
            border: none;
            font-size: 0.95rem;
            letter-spacing: 0.025em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table th:first-child {
            border-top-left-radius: var(--radius-xl);
        }

        .table th:last-child {
            border-top-right-radius: var(--radius-xl);
        }

        .table td {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .table tbody tr {
            transition: all 0.2s ease;
            background: white;
        }

        .table tbody tr:hover {
            background: linear-gradient(90deg, var(--accent-color) 0%, #f8fafc 100%);
            transform: scale(1.01);
            box-shadow: var(--shadow-md);
        }

        .table tbody tr:nth-child(even) {
            background: linear-gradient(90deg, #fafbfc 0%, #ffffff 100%);
        }

        .table tbody tr:nth-child(even):hover {
            background: linear-gradient(90deg, var(--accent-color) 0%, #f1f5f9 100%);
        }

        .complaint-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .complaint-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .complaint-btn:active {
            transform: translateY(0);
        }

        .proof-image {
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 2px solid transparent;
        }

        .proof-image:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
            border-color: var(--secondary-color);
        }

        .back-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
            border: 2px solid transparent;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #1e4066 0%, var(--primary-color) 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
            color: white;
            text-decoration: none;
            border-color: var(--secondary-color);
        }

        .back-btn:active {
            transform: translateY(-1px);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--border-color);
            margin-bottom: 1.5rem;
            display: block;
        }

        .empty-state p {
            font-size: 1.25rem;
            font-weight: 500;
            margin: 0;
        }

        /* Modal Enhancements */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1100;
            padding-top: 50px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(5px);
        }

        .image-modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 80%;
            animation: modalZoom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            cursor: grab;
            transition: transform 0.2s ease;
            transform-origin: center center;
        }

        .image-modal-content:active {
            cursor: grabbing;
        }

        .image-modal-content.zoomed {
            cursor: move;
        }

        /* Added zoom indicator */
        .zoom-indicator {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        @keyframes modalZoom {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 40px;
            color: #f1f1f1;
            font-size: 3rem;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .close-modal:hover,
        .close-modal:focus {
            color: var(--secondary-color);
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .image-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem;
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
        }

        .image-control-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .image-control-btn:hover {
            background: linear-gradient(135deg, #1e4066 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .modal-content {
            border-radius: var(--radius-xl);
            border: none;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: 1.5rem;
        }

        .modal-body {
            padding: 2rem;
            line-height: 1.7;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
        }

        .modal-footer button {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .modal-footer button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Footer Enhancements */
        footer {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e4066 100%);
            color: white;
            padding: 3rem 0 2rem;
            position: relative;
            z-index: 1;
            margin-top: 4rem;
        }

        footer h3 {
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
        }

        footer a {
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.8);
        }

        footer a:hover {
            color: var(--secondary-color);
            transform: translateX(4px);
        }

        .map-container {
            border-radius: var(--radius-xl);
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        .map-container:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--secondary-color);
        }

        @keyframes patternMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 60px 60px, -60px 60px; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body { padding-top: 120px; }

            .main-container {
                margin: 1rem;
                padding: 1.5rem;
                border-radius: var(--radius-lg);
            }

            .page-title {
                font-size: 2rem;
                margin-bottom: 1.5rem;
            }

            .table th, .table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.8rem;
            }

            .dropdown-menu {
                width: 100%;
                left: 0;
            }

            .table-responsive {
                overflow-x: auto;
            }

            .map-container iframe {
                height: 200px;
            }

            .container.mx-auto {
                padding: 0 1rem;
            }

            .image-controls {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .image-control-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }

            .close-modal {
                top: 15px;
                right: 20px;
                font-size: 2rem;
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 640px) {
            .page-title {
                font-size: 1.75rem;
            }

            .back-btn {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }

            .complaint-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }

        .pagination-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .pagination-info {
            color: #6c757d;
            font-size: 14px;
        }

        .pagination .page-link {
            color: #007bff;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
        }

        .pagination .page-link:hover {
            background-color: #e9ecef;
            border-color: #dee2e6;
        }

        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
            background-color: #fff;
            border-color: #dee2e6;
        }

        .pagination .page-item:first-child .page-link {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }

        .pagination .page-item:last-child .page-link {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }
    </style>
</head>
<body class="bg-gray-100">
<!-- Ticker -->
<div class="ticker py-1 overflow-hidden" style="height: 40px;">
    <marquee behavior="scroll" direction="left" scrollamount="5">
        🎉 Khuyến mãi đặc biệt: Giảm giá lên đến 50% cho tất cả sản phẩm hôm nay! 🎉 - Miễn phí vận chuyển cho đơn từ 500k!
    </marquee>
</div>

<div th:replace="~{fragments/kh_navbar :: navbar(user=${user}, keyword=${keyword}, cartCount=${cartCount})}"></div>

<!-- Main Content -->
<section class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="main-container">
        <h2 class="page-title">
            <i class="fas fa-history"></i>Lịch Sử Giao Dịch Ví
        </h2>

        <!-- Thông báo nếu có -->
        <div th:if="${msg}" class="alert" th:text="${msg}"></div>

        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover" id="transactionTable">
                    <thead>
                    <tr>
                        <th>Loại giao dịch</th>
                        <th>Số tiền</th>
                        <th>Thời gian</th>
                        <th>Mô tả</th>
                        <th>Ảnh bằng chứng</th>
                        <th>Hành động</th>
                    </tr>
                    </thead>
                    <tbody id="transactionTableBody">
                    <tr th:each="ls : ${lichSu}" class="transaction-row">
                        <td th:text="${ls.loaiGiaoDich}"></td>
                        <td th:text="${#numbers.formatDecimal(ls.soTien, 0, 'COMMA', 0, 'POINT')} + ' VND'"></td>
                        <td th:text="${#temporals.format(ls.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${ls.moTa}"></td>
                        <td>
                            <img th:if="${ls.anhBangChung != null and not #strings.isEmpty(ls.anhBangChung)}"
                                 th:src="@{${ls.anhBangChung}}"
                                 alt="Bằng chứng"
                                 class="proof-image"
                                 style="width: 100px; height: auto;"
                                 onclick="openImageModal(this.src, 'Ảnh bằng chứng giao dịch')"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';"/>
                            <span th:if="${ls.anhBangChung == null or #strings.isEmpty(ls.anhBangChung)}"
                                  class="text-gray-600">Không có</span>
                        </td>
                        <td>
                            <button class="complaint-btn" data-bs-toggle="modal" data-bs-target="#complaintModal" th:attr="data-transaction-id=${ls.id}">Khiếu nại</button>
                        </td>
                    </tr>
                    <tr th:if="${lichSu == null or lichSu.isEmpty()}" id="emptyState">
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <p>Không có giao dịch nào.</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Added pagination controls -->
        <div class="pagination-container mt-4" id="paginationContainer" style="display: none;">
            <div class="d-flex justify-content-between align-items-center">
                <div class="pagination-info">
                    Hiển thị <span id="startItem">1</span> - <span id="endItem">10</span> của <span id="totalItems">0</span> giao dịch
                </div>
                <nav aria-label="Phân trang giao dịch">
                    <ul class="pagination mb-0">
                        <li class="page-item" id="prevPage">
                            <a class="page-link" href="#" onclick="changePage('prev')">
                                <i class="fas fa-chevron-left"></i> Trước
                            </a>
                        </li>
                        <li class="page-item" id="nextPage">
                            <a class="page-link" href="#" onclick="changePage('next')">
                                Sau <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="mt-8 flex justify-center">
            <a th:href="@{/vi}" class="back-btn">
                <i class="fas fa-arrow-left"></i>Quay lại ví
            </a>
        </div>
    </div>
</section>

<!-- Modal Zoom Ảnh -->
<div id="imageModal" class="image-modal">
    <span class="close-modal" onclick="closeImageModal()">&times;</span>
    <!-- Added zoom indicator -->
    <div class="zoom-indicator" id="zoomIndicator">100%</div>
    <img class="image-modal-content" id="modalImage">
    <div class="image-controls">
        <button class="image-control-btn" onclick="downloadImage()">
            <i class="fas fa-download mr-2"></i> Tải về
        </button>
        <button class="image-control-btn" onclick="zoomIn()">
            <i class="fas fa-search-plus mr-2"></i> Phóng to
        </button>
        <button class="image-control-btn" onclick="zoomOut()">
            <i class="fas fa-search-minus mr-2"></i> Thu nhỏ
        </button>
        <button class="image-control-btn" onclick="resetZoom()">
            <i class="fas fa-sync-alt mr-2"></i> Mặc định
        </button>
        <!-- Added fit to screen button -->
        <button class="image-control-btn" onclick="fitToScreen()">
            <i class="fas fa-expand-arrows-alt mr-2"></i> Vừa màn hình
        </button>
    </div>
</div>

<!-- Complaint Modal -->
<div class="modal fade" id="complaintModal" tabindex="-1" aria-labelledby="complaintModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-[#153054] text-white">
                <h5 class="modal-title" id="complaintModalLabel">Liên hệ khiếu nại</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Vui lòng liên hệ với chúng tôi qua hotline để được hỗ trợ khiếu nại:</p>
                <p class="font-bold text-lg text-[#153054] mt-3">Hotline: 0911 006 045</p>
                <p class="text-[#153054]"><i class="fas fa-envelope mr-2 text-[#9FD5F7]"></i> Email: datn.acv@gmail.com</p>
                <p class="mt-4 text-gray-600">Chúng tôi sẽ hỗ trợ bạn trong thời gian sớm nhất. Cảm ơn bạn đã tin tưởng ACV Store!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition-all duration-300" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer style="background: linear-gradient(to right, #153054, #1e4066); color: white; padding-top: 30px; padding-bottom: 20px; position: relative; z-index: 1;">
  <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
    <div>
      <h3 class="text-lg font-bold mb-4">ACV Store</h3>
      <p class="text-sm">Cửa hàng thời trang hàng đầu với các sản phẩm chất lượng và giá cả hợp lý.</p>
    </div>
    <div>
      <h3 class="text-lg font-bold mb-4">Liên kết nhanh</h3>
      <ul class="space-y-2">
        <li><a href="/new" class="hover:text-blue-300">Sản phẩm mới</a></li>
        <li><a href="/all" class="hover:text-blue-300">Tất cả sản phẩm</a></li>
        <li><a href="/bestsellers" class="hover:text-blue-300">Sản phẩm bán chạy</a></li>
        <li><a href="/chinh-sach" class="hover:text-blue-300">Chính sách</a></li>
      </ul>
    </div>
    <div>
      <h3 class="text-lg font-bold mb-4">Liên hệ</h3>
      <p class="text-sm">Địa chỉ: 330 Phố Nam Dư, Trần Phú, Hai Bà Trưng, Hà Nội, Việt Nam</p>
      <p class="text-sm">Email: datn.acv@gmail.com</p>
      <p class="text-sm">Hotline: 0911 006 045</p>
      <div class="flex space-x-4 mt-4">
        <a href="https://www.facebook.com" class="text-white hover:text-blue-300" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.instagram.com" class="text-white hover:text-blue-300" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://twitter.com" class="text-white hover:text-blue-300" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
  </div>
  <div class="container mx-auto mt-8">
    <div class="map-container relative overflow-hidden rounded-lg shadow-md transition-all duration-300 hover:shadow-lg">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3724.7142835949912!2d105.85287637508011!3d21.004087180639065!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135ad002fc50fd1%3A0x9a7962d208d20498!2sACV%20Store!5e0!3m2!1sen!2s!4v1755701406991!5m2!1sen!2s" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
    <p class="text-center text-sm mt-2 text-gray-300">* Bản đồ hiển thị vị trí chi nhánh chính tại ACV Store tại 330 Phố Nam Dư, Trần Phú, Hai Bà Trưng, Hà Nội. Vui lòng liên hệ để xác nhận giờ mở cửa.</p>
  </div>
  <div class="text-center mt-8 text-sm">© 2025 ACV Store. All rights reserved.</div>

  <div class="absolute top-0 left-0 w-full h-full bg-[linear-gradient(45deg,transparent_40%,rgba(0,0,0,0.02)_50%,transparent_60%),linear-gradient(-45deg,transparent_40%,rgba(0,0,0,0.02)_50%,transparent_60%)] bg-[length:60px_60px] animate-[patternMove_20s_linear_infinite] -z-10"></div>
</footer>

<!-- Back to Top Button -->
<button id="back-to-top" class="fixed bottom-20 right-20 bg-blue-600 text-white p-3 rounded-full shadow-lg hidden" aria-label="Quay lại đầu trang">
    <i class="fas fa-arrow-up"></i>
</button>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<script src="/js/navbar.js"></script>

<script>

    let currentScale = 1;
    let currentImageUrl = '';
    let currentImageName = '';
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let translateX = 0;
    let translateY = 0;

    // Mở modal ảnh
    function openImageModal(imageUrl, imageName) {
        currentImageUrl = imageUrl;
        currentImageName = imageName || 'proof_image';
        currentScale = 1;
        translateX = 0;
        translateY = 0;

        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');

        modal.style.display = "block";
        modalImg.src = imageUrl;
        updateImageTransform();
        updateZoomIndicator();

        modalImg.addEventListener('wheel', handleWheel, { passive: false });
        modalImg.addEventListener('mousedown', handleMouseDown);
        modalImg.addEventListener('mousemove', handleMouseMove);
        modalImg.addEventListener('mouseup', handleMouseUp);
        modalImg.addEventListener('mouseleave', handleMouseUp);

        document.addEventListener('keydown', handleKeyDown);
    }

    // Đóng modal ảnh
    function closeImageModal() {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');

        modal.style.display = "none";

        modalImg.removeEventListener('wheel', handleWheel);
        modalImg.removeEventListener('mousedown', handleMouseDown);
        modalImg.removeEventListener('mousemove', handleMouseMove);
        modalImg.removeEventListener('mouseup', handleMouseUp);
        modalImg.removeEventListener('mouseleave', handleMouseUp);
        document.removeEventListener('keydown', handleKeyDown);
    }

    function zoomIn() {
        currentScale = Math.min(currentScale + 0.25, 5);
        updateImageTransform();
        updateZoomIndicator();
    }

    function zoomOut() {
        currentScale = Math.max(currentScale - 0.25, 0.25);
        updateImageTransform();
        updateZoomIndicator();
    }

    function resetZoom() {
        currentScale = 1;
        translateX = 0;
        translateY = 0;
        updateImageTransform();
        updateZoomIndicator();
    }

    function fitToScreen() {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        const modalRect = modal.getBoundingClientRect();

        // Calculate scale to fit image in modal
        const scaleX = (modalRect.width * 0.9) / modalImg.naturalWidth;
        const scaleY = (modalRect.height * 0.8) / modalImg.naturalHeight;
        currentScale = Math.min(scaleX, scaleY, 1);

        translateX = 0;
        translateY = 0;
        updateImageTransform();
        updateZoomIndicator();
    }

    function handleWheel(e) {
        e.preventDefault();
        const delta = e.deltaY > 0 ? -0.1 : 0.1;
        currentScale = Math.max(0.25, Math.min(5, currentScale + delta));
        updateImageTransform();
        updateZoomIndicator();
    }

    function handleMouseDown(e) {
        if (currentScale > 1) {
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            document.getElementById('modalImage').classList.add('zoomed');
        }
    }

    function handleMouseMove(e) {
        if (isDragging && currentScale > 1) {
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            updateImageTransform();
        }
    }

    function handleMouseUp() {
        isDragging = false;
        document.getElementById('modalImage').classList.remove('zoomed');
    }

    function handleKeyDown(e) {
        switch(e.key) {
            case '+':
            case '=':
                e.preventDefault();
                zoomIn();
                break;
            case '-':
                e.preventDefault();
                zoomOut();
                break;
            case '0':
                e.preventDefault();
                resetZoom();
                break;
            case 'Escape':
                closeImageModal();
                break;
        }
    }

    function updateImageTransform() {
        const modalImg = document.getElementById('modalImage');
        modalImg.style.transform = `scale(${currentScale}) translate(${translateX/currentScale}px, ${translateY/currentScale}px)`;
    }

    function updateZoomIndicator() {
        const indicator = document.getElementById('zoomIndicator');
        indicator.textContent = `${Math.round(currentScale * 100)}%`;
    }

    // Tải ảnh về máy
    function downloadImage() {
        const link = document.createElement('a');
        link.href = currentImageUrl;
        link.download = `${currentImageName}_${new Date().getTime()}.jpg`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Added pagination JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        const rowsPerPage = 10;
        let currentPage = 1;
        let totalRows = 0;

        const transactionRows = document.querySelectorAll('.transaction-row');
        const emptyState = document.getElementById('emptyState');
        const paginationContainer = document.getElementById('paginationContainer');

        totalRows = transactionRows.length;

        // Hide empty state if there are transactions
        if (totalRows > 0) {
            if (emptyState) emptyState.style.display = 'none';

            // Show pagination if more than 10 rows
            if (totalRows > rowsPerPage) {
                paginationContainer.style.display = 'block';
            }

            showPage(1);
        }

        function showPage(page) {
            currentPage = page;
            const startIndex = (page - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;

            // Hide all rows first
            transactionRows.forEach(row => {
                row.style.display = 'none';
            });

            // Show rows for current page
            for (let i = startIndex; i < endIndex && i < totalRows; i++) {
                if (transactionRows[i]) {
                    transactionRows[i].style.display = '';
                }
            }

            updatePaginationInfo();
            updatePaginationButtons();
        }

        function updatePaginationInfo() {
            const startItem = (currentPage - 1) * rowsPerPage + 1;
            const endItem = Math.min(currentPage * rowsPerPage, totalRows);

            document.getElementById('startItem').textContent = startItem;
            document.getElementById('endItem').textContent = endItem;
            document.getElementById('totalItems').textContent = totalRows;
        }

        function updatePaginationButtons() {
            const totalPages = Math.ceil(totalRows / rowsPerPage);
            const prevButton = document.getElementById('prevPage');
            const nextButton = document.getElementById('nextPage');

            // Update previous button
            if (currentPage <= 1) {
                prevButton.classList.add('disabled');
            } else {
                prevButton.classList.remove('disabled');
            }

            // Update next button
            if (currentPage >= totalPages) {
                nextButton.classList.add('disabled');
            } else {
                nextButton.classList.remove('disabled');
            }
        }

        // Make changePage function global
        window.changePage = function(direction) {
            const totalPages = Math.ceil(totalRows / rowsPerPage);

            if (direction === 'prev' && currentPage > 1) {
                showPage(currentPage - 1);
            } else if (direction === 'next' && currentPage < totalPages) {
                showPage(currentPage + 1);
            }
        };
    });

</script>
</body>
</html>